# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Loxlex provides lexer implementations for use with Lox (the parser generator located at ../lox). Currently contains SimpleLexer, a mode-based lexer that supports context-sensitive tokenization.

## Commands

### Testing
```bash
# Run all tests
go test -v -race -timeout 10m ./...

# Run specific package tests
go test ./simplelexer/loxtest
```

### Building
```bash
# Verify compilation
go build ./...

# Ensure dependencies are correct
go mod tidy
```

### Code Generation
To regenerate the test parser from `.lox` files:
```bash
# Requires lox to be installed from ../lox
cd simplelexer/loxtest
lox .
```

## Architecture

### SimpleLexer

The SimpleLexer package provides a lexer implementation with:
- **Mode-based lexing**: Supports pushing/popping lexer modes for context-sensitive tokenization
- **State machine interface**: Clean API for mode transitions
- **Integration with Lox**: Designed to work with parsers generated by Lox

Key files:
- `simplelexer/lexer.go`: Core lexer implementation with mode support
- `simplelexer/loxtest/`: Test implementation showing SimpleLexer usage with Lox-generated parser

### Test Parser Example

The test parser in `simplelexer/loxtest/parser.lox` demonstrates:
- Basic token definitions (`NUM = [0-9]+`)
- Mode switching for string parsing
- Fragment patterns for complex token matching
- Unicode escape sequence handling

## Relationship with Lox

This repository provides lexer implementations that:
1. Implement the interfaces expected by Lox-generated parsers
2. Can be imported and used by projects that use Lox for parser generation
3. Are tested using Lox-generated test parsers

To use SimpleLexer in a Lox-based project:
```go
import "github.com/dcaiafa/loxlex/simplelexer"
```

## Development Notes

- Go version 1.18+ required
- No external dependencies (pure Go implementation)
- The `*.gen.go` files in loxtest are generated by Lox and should not be edited manually